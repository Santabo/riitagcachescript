<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Caching Script with Debugging</title>
</head>
<body>
    <script>
        // Function to fetch data from API and replace contents of cache.json
        const fetchAndReplaceCache = async () => {
            const apiUrl = 'https://tag.rc24.xyz/api/user/789872551731527690'; // Replace with your API URL
            const cacheUrl = 'https://raw.githubusercontent.com/Santabo/riitagcachescript/main/cache.json'; // Replace with your cache JSON file URL

            try {
                const response = await fetch(apiUrl, { timeout: 15000 }); // Adjust timeout as needed (15 seconds in this example)
                if (!response.ok) {
                    throw new Error('Failed to fetch API data');
                }

                const data = await response.json();
                console.log('Fetched data from API:', data);

                // Fetch current contents of cache.json to get ETag
                const cacheResponse = await fetch(cacheUrl);
                if (!cacheResponse.ok) {
                    throw new Error('Failed to fetch current cache.json');
                }
                const etag = cacheResponse.headers.get('ETag');
                console.log('Current ETag:', etag);

                // Replace the JSON data in cache.json using PUT with ETag
                const putResponse = await fetch(cacheUrl, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'If-Match': etag // Ensure we're updating the correct version
                    },
                    body: JSON.stringify(data)
                });

                if (!putResponse.ok) {
                    throw new Error('Failed to update cache file');
                }

                console.log('API data cached and replaced successfully');
            } catch (error) {
                console.error('Error caching API data:', error.message);
            }
        };

        // Call fetchAndReplaceCache function on page load
        fetchAndReplaceCache();
    </script>
</body>
</html>
